<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students Table</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

<h2>Students Data</h2>

<table id="studentsTable">
    <thead>
        <tr>
            <th>RegNo</th>
            <th>Name</th>
            <th>Section</th>
            <th>Serial</th>
            <th>ADP</th>

        </tr>
    </thead>
    <tbody>
        <!-- Data will be inserted here -->
    </tbody>
</table>

<script>
    // Fetch data from all three APIs simultaneously
    Promise.all([
        fetch('http://localhost:8080/students').then(response => response.json()),
        fetch('http://localhost:8080/adp').then(response => response.json()),
        fetch('http://localhost:8080/iml').then(response => response.json())
    ])
    .then(([studentsData, adpData, imlData]) => {
        const tableBody = document.querySelector('#studentsTable tbody');
        
        // Filter students, ADP, and IML data for section 'G'
        const filteredStudents = studentsData.filter(student => student.sec === 'G');
        const filteredAdp = adpData.filter(adp => adp.sec === 'G');
        const filteredIml = imlData.filter(iml => iml.sec === 'G');

        // Loop through all students
        filteredStudents.forEach(student => {
            // Find corresponding ADP and IML data for each student
            const adp = filteredAdp.find(adp => adp.regno === student.regno);
            const iml = filteredIml.find(iml => iml.regno === student.regno);

            // Create a row only if both ADP and IML data are found
            if (adp && iml) {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${student.regno}</td>
                    <td>${student.name}</td>
                    <td>${student.sec}</td>
                    <td>${student.serial}</td>
                    <td>${((adp.present/adp.total)*100).toFixed(2)+"%"}</td>
                    
                `;
                
                tableBody.appendChild(row);
            }
        });
    })
    .catch(error => console.error('Error fetching data:', error));
</script>

</body>
</html>
